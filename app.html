<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Công Tác BHS - Smart View</title>
    <style>
        :root {
            --primary-blue: #2c5282;
            --header-text: #1a365d;
            --bg-active: #2b6cb0;
            --text-red: #c53030;
            --border-color: #e2e8f0;
            --badge-yellow: #ecc94b;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
        body { background-color: #f7fafc; padding: 20px; font-size: 14px; }

        /* HEADER */
        .header-container { text-align: center; margin-bottom: 20px; }
        .main-title { color: var(--header-text); font-size: 22px; font-weight: 800; text-transform: uppercase; margin-bottom: 15px; }
        
        .stats-bar { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .stat-item { background: white; padding: 6px 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-weight: 600; font-size: 13px; }
        .stat-item span { color: var(--text-red); }

        .filter-bar { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .btn-filter {
            padding: 6px 14px; border: 1px solid var(--border-color); background: white;
            border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600; color: #4a5568; transition: all 0.2s;
        }
        .btn-filter.active { background-color: var(--bg-active); color: white; border-color: var(--bg-active); }

        /* TABLE */
        .table-responsive { overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; /* Đảm bảo bảng đủ rộng */ }
        
        th {
            background-color: var(--primary-blue); color: white; padding: 12px 10px;
            font-size: 13px; text-transform: uppercase; font-weight: 700; text-align: left;
            position: sticky; top: 0; white-space: nowrap; z-index: 10;
        }

        td {
            padding: 10px; border-bottom: 1px solid var(--border-color); border-right: 1px solid var(--border-color);
            color: #2d3748; vertical-align: top; /* Căn lề trên để dễ nhìn khi nội dung dài */
            line-height: 1.5;
        }

        /* SMART CONTENT STYLING */
        /* Cho phép xuống dòng và giữ định dạng văn bản */
        .text-wrap { 
            white-space: pre-line; 
            word-wrap: break-word; 
            max-width: 300px; /* Giới hạn chiều rộng để text tự xuống dòng */
        }

        .col-date { font-weight: 700; color: var(--primary-blue); text-align: center; background-color: #ebf8ff; width: 80px; vertical-align: middle; }
        .col-time { color: var(--text-red); font-weight: 700; width: 80px; white-space: nowrap; }
        .col-host { width: 80px; }
        
        /* Logic nút Xem thêm */
        .more-content { display: none; }
        .btn-read-more {
            color: var(--bg-active); font-size: 11px; font-weight: bold; cursor: pointer;
            text-decoration: underline; display: block; margin-top: 5px; border: none; background: none; padding: 0;
        }
        .btn-read-more:hover { color: var(--text-red); }

        /* Badges */
        .badge { padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 4px;}
        .badge-warning { background-color: var(--badge-yellow); color: #744210; }
        .badge-dept { background-color: #e2e8f0; color: #2d3748; }

        tr:hover td { background-color: #faf5ff; }
    </style>
</head>
<body>

    <div class="header-container">
        <h1 class="main-title">LỊCH CÔNG TÁC BHS TUẦN 18 (2025)</h1>
        
        <div class="stats-bar">
            <div class="stat-item">Tổng sự kiện: <span id="totalEvents">0</span></div>
            <div class="stat-item">BGH chủ trì: <span id="totalBGH">0</span></div>
            <div class="stat-item">Hôm nay: <span style="color: green;">03/12</span></div>
        </div>

        <div class="filter-bar" id="filterContainer"></div>
    </div>

    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Ngày</th>
                    <th>Thời gian</th>
                    <th style="width: 20%;">Nội dung chính</th>
                    <th style="width: 25%;">Nội dung chi tiết</th>
                    <th>Chủ trì</th>
                    <th>Thành phần</th>
                    <th>Địa điểm</th>
                    <th>Ghi chú</th>
                    <th>Đơn vị</th>
                </tr>
            </thead>
            <tbody id="scheduleBody"></tbody>
        </table>
    </div>

    <script>
        // --- 1. DỮ LIỆU MẪU (BẠN COPY NỘI DUNG DÀI VÀO ĐÂY THOẢI MÁI) ---
        const rawScheduleData = [
            {
                date: "01/12", day: "Thứ 2",
                events: [
                    { 
                        time: "7:30 SA", content: "Chào cờ", 
                        detail: "Chào cờ đầu tuần. Triển khai kế hoạch tháng 12. Phát động phong trào thi đua 'Dạy tốt - Học tốt'.\nKhen thưởng các lớp đạt thành tích cao trong tuần qua.", 
                        host: "TPT", attendees: "Toàn trường", location: "Sân trường", note: "", dept: "TH" 
                    },
                    { 
                        time: "7:45 SA", content: "Trải nghiệm AI ROBOTICS", 
                        detail: "Học sinh lớp 1/2 và 1/1 tham gia trải nghiệm. Nội dung: Làm quen với Robot Alpha Mini, lập trình kéo thả cơ bản.", 
                        host: "GVCN", attendees: "GVCN, QS", location: "Phòng AI ROBOTICS", note: "GVCN quản lý HS", dept: "TH" 
                    }
                ]
            },
            {
                date: "02/12", day: "Thứ 3",
                events: [
                    { 
                        time: "7:45 SA", content: "Dự giờ thăm lớp", 
                        detail: "Dự giờ đột xuất các lớp khối 4, 5. Kiểm tra hồ sơ giáo án giáo viên.\nLưu ý: GV cần chuẩn bị đầy đủ hồ sơ theo quy định mới nhất của Bộ GD.", 
                        host: "BGH", attendees: "BGH, Tổ trưởng CM", location: "Lớp học", note: "Quan trọng", dept: "TH", isHighlight: true 
                    },
                    { 
                        time: "8:00 SA", content: "Tập huấn chuyên môn", 
                        detail: "Tập huấn phương pháp dạy học tích cực môn Ngữ Văn theo chương trình GDPT 2018. \nNgười trình bày: TS. Nguyễn Văn A - Đại học Sư Phạm.", 
                        host: "SGD", attendees: "GV Văn THCS", location: "Hội trường B", note: "", dept: "THCS" 
                    }
                ]
            },
            // ... Bạn có thể thêm các ngày tiếp theo ở đây
             {
                date: "03/12", day: "Thứ 4",
                events: [
                     { time: "14:00", content: "Họp BGH", detail: "Họp giao ban tuần", host: "BGH", attendees: "BGH", location: "VP", note: "", dept: "VP" }
                ]
            }
        ];

        // --- 2. HÀM LOGIC XỬ LÝ HIỂN THỊ THÔNG MINH ---

        function initFilters() {
            const days = ["Tất cả", "Thứ 2", "Thứ 3", "Thứ 4", "Thứ 5", "Thứ 6", "Thứ 7", "Chủ Nhật"];
            const container = document.getElementById('filterContainer');
            
            days.forEach((day, index) => {
                const btn = document.createElement('button');
                btn.className = `btn-filter ${index === 0 ? 'active' : ''}`;
                btn.innerText = day;
                btn.onclick = () => filterSchedule(day, btn);
                container.appendChild(btn);
            });
        }

        // Hàm xử lý văn bản dài: Cắt ngắn và thêm nút Xem thêm
        function processLongText(text, limit = 80) {
            if (!text) return "";
            if (text.length <= limit) return `<div class="text-wrap">${text}</div>`;

            // Tạo ID ngẫu nhiên cho mỗi đoạn văn bản để toggle
            const uniqueId = 'more-' + Math.random().toString(36).substr(2, 9);
            const shortText = text.substring(0, limit);
            const fullText = text;

            return `
                <div class="text-wrap">
                    <span id="short-${uniqueId}">${shortText}...</span>
                    <span id="full-${uniqueId}" class="more-content">${fullText}</span>
                    <button class="btn-read-more" onclick="toggleText('${uniqueId}', this)">Xem thêm</button>
                </div>
            `;
        }

        // Hàm bật/tắt xem thêm
        window.toggleText = function(id, btn) {
            const shortSpan = document.getElementById(`short-${id}`);
            const fullSpan = document.getElementById(`full-${id}`);
            
            if (fullSpan.style.display === "inline") {
                fullSpan.style.display = "none";
                shortSpan.style.display = "inline";
                btn.innerText = "Xem thêm";
            } else {
                fullSpan.style.display = "inline";
                shortSpan.style.display = "none";
                btn.innerText = "Thu gọn";
            }
        }

        function renderSchedule(filterDay = "Tất cả") {
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = ''; 
            
            let totalEvt = 0;
            let totalBGH = 0;

            rawScheduleData.forEach(dayGroup => {
                if (filterDay !== "Tất cả" && dayGroup.day !== filterDay) return;

                const rowCount = dayGroup.events.length;
                dayGroup.events.forEach((evt, index) => {
                    totalEvt++;
                    if(evt.host === 'BGH') totalBGH++;

                    const tr = document.createElement('tr');

                    if (index === 0) {
                        const tdDate = document.createElement('td');
                        tdDate.className = 'col-date';
                        tdDate.rowSpan = rowCount;
                        tdDate.innerHTML = `${dayGroup.day}<br><small>${dayGroup.date}</small>`;
                        tr.appendChild(tdDate);
                    }

                    const hostDisplay = evt.host === 'BGH' || evt.isHighlight 
                        ? `<span class="badge badge-warning">${evt.host}</span>` 
                        : evt.host;

                    // Áp dụng hàm processLongText cho Nội dung chính và Chi tiết
                    tr.innerHTML += `
                        <td class="col-time">${evt.time}</td>
                        <td class="col-content">${processLongText(evt.content, 60)}</td>
                        <td>${processLongText(evt.detail, 100)}</td>
                        <td class="col-host">${hostDisplay}</td>
                        <td>${processLongText(evt.attendees, 50)}</td>
                        <td>${evt.location}</td>
                        <td>${processLongText(evt.note, 50)}</td>
                        <td><span class="badge badge-dept">${evt.dept}</span></td>
                    `;
                    tbody.appendChild(tr);
                });
            });

            // Update stats
            document.getElementById('totalEvents').innerText = totalEvt;
            document.getElementById('totalBGH').innerText = totalBGH;
        }

        function filterSchedule(selectedDay, btnElement) {
            document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            renderSchedule(selectedDay);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initFilters();
            renderSchedule();
        });
    </script>
</body>
</html>
